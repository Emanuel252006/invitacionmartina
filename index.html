<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primera Comuni√≥n de Martina</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="invitation-container">
        <div class="invitation-card">
            <div class="header-decoration">
                <div class="decoration-circle circle-1"></div>
                <div class="decoration-circle circle-2"></div>
                <div class="decoration-circle circle-3"></div>
            </div>
            
            <div class="invitation-content">
                <h1 class="title">Primera Comuni√≥n</h1>
                
                <div class="name-section">
                    <h2 class="name">Martina</h2>
                </div>
                
                <div class="music-player-container">
                    <div class="music-player">
                        <button id="music-toggle" class="play-pause-btn" aria-label="Reproducir/Pausar m√∫sica">
                            <span id="music-icon">‚è∏</span>
                        </button>
                        <div class="music-info">
                            <div class="music-title">Mientras Me Sigas Necesitando</div>
                            <div class="music-time">
                                <span id="current-time">0:00</span> / <span id="total-time">0:00</span>
                            </div>
                        </div>
                        <div class="volume-control">
                            <span class="volume-icon">üîä</span>
                            <input type="range" id="volume-slider" min="0" max="100" value="50" class="volume-slider">
                        </div>
                    </div>
                </div>
                
                <div class="date-section">
                    <p class="date-label">8 de Diciembre</p>
                </div>
                
                <div class="details-section">
                    <div class="event-detail">
                        <div class="icon">‚õ™</div>
                        <div class="event-info">
                            <p class="event-title">Santa Misa</p>
                            <p class="event-time">10:00 AM</p>
                            <p class="event-location">Nuestra Se√±ora del Carmen</p>
                            <p class="event-subtitle">El que quiera acompa√±arnos</p>
                        </div>
                    </div>
                    
                    <div class="event-detail">
                        <div class="icon">üéâ</div>
                        <div class="event-info">
                            <p class="event-title">Celebraci√≥n</p>
                            <p class="event-time">4:00 PM</p>
                            <p class="event-location">Calle 42#104-10</p>
                        </div>
                    </div>
                </div>
                
                <div class="footer-message">
                    <p>¬°Te esperamos para compartir este d√≠a tan especial!</p>
                </div>
                
                <div class="button-container">
                    <div class="envelope-rain">
                        <div class="envelope envelope-1">üíå</div>
                        <div class="envelope envelope-2">üíå</div>
                        <div class="envelope envelope-3">üíå</div>
                        <div class="envelope envelope-4">üíå</div>
                        <div class="envelope envelope-5">üíå</div>
                        <div class="envelope envelope-6">üíå</div>
                    </div>
                    <a href="https://wa.me/3508254638" target="_blank" class="confirm-button">
                        Confirmar Asistencia
                    </a>
                </div>
            </div>
            
            <div class="footer-decoration">
                <div class="leaf leaf-1">‚ú®</div>
                <div class="leaf leaf-2">‚ú®</div>
                <div class="leaf leaf-3">‚ú®</div>
            </div>
        </div>
    </div>
    
    <audio id="background-music" loop preload="auto" muted>
        <source src="musica/Mientras Me Sigas Necesitando.mp3" type="audio/mpeg">
        Tu navegador no soporta el elemento de audio.
    </audio>
    
    <script>
        const audio = document.getElementById('background-music');
        const musicToggle = document.getElementById('music-toggle');
        const musicIcon = document.getElementById('music-icon');
        const volumeSlider = document.getElementById('volume-slider');
        const currentTimeSpan = document.getElementById('current-time');
        const totalTimeSpan = document.getElementById('total-time');
        
        audio.volume = 0.5; // Volumen al 50%
        
        // Formatear tiempo en minutos:segundos
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }
        
        // Actualizar tiempo total cuando se carga el audio
        audio.addEventListener('loadedmetadata', function() {
            totalTimeSpan.textContent = formatTime(audio.duration);
        });
        
        // Actualizar tiempo actual
        audio.addEventListener('timeupdate', function() {
            currentTimeSpan.textContent = formatTime(audio.currentTime);
        });
        
        // Funci√≥n para reproducir autom√°ticamente
        function startAutoPlay() {
            // Los navegadores permiten autoplay si est√° muted
            // Primero reproducimos con muted, luego desmutamos
            audio.muted = true;
            
            const playPromise = audio.play();
            
            if (playPromise !== undefined) {
                playPromise.then(function() {
                    // Una vez que est√° reproduciendo, desmutamos
                    setTimeout(function() {
                        audio.muted = false;
                        musicIcon.textContent = '‚è∏';
                    }, 100);
                }).catch(function(error) {
                    // Si falla, intentar sin muted como respaldo
                    audio.muted = false;
                    audio.play().then(function() {
                        musicIcon.textContent = '‚è∏';
                    }).catch(function() {
                        musicIcon.textContent = '‚ñ∂';
                    });
                });
            }
        }
        
        // Intentar reproducir cuando el audio est√° listo
        audio.addEventListener('canplay', function() {
            if (audio.paused) {
                startAutoPlay();
            }
        });
        
        audio.addEventListener('canplaythrough', function() {
            if (audio.paused) {
                startAutoPlay();
            }
        });
        
        // Intentar cuando la p√°gina carga
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (audio.paused) {
                    startAutoPlay();
                }
            }, 100);
        });
        
        // Intentar inmediatamente si el DOM ya est√° listo
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            setTimeout(function() {
                if (audio.paused) {
                    startAutoPlay();
                }
            }, 200);
        } else {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(function() {
                    if (audio.paused) {
                        startAutoPlay();
                    }
                }, 200);
            });
        }
        
        // Intentar cuando el usuario interact√∫a (respaldo)
        function handleInteraction() {
            if (audio.paused) {
                audio.muted = false;
                startAutoPlay();
            }
        }
        
        document.addEventListener('click', handleInteraction, { once: true });
        document.addEventListener('touchstart', handleInteraction, { once: true });
        document.addEventListener('mousemove', handleInteraction, { once: true });
        document.addEventListener('keydown', handleInteraction, { once: true });
        
        // Intentar cada 300ms hasta que funcione (m√°ximo 30 intentos = 9 segundos)
        let attempts = 0;
        const maxAttempts = 30;
        const autoPlayInterval = setInterval(function() {
            if (audio.paused && attempts < maxAttempts) {
                attempts++;
                startAutoPlay();
            } else if (!audio.paused) {
                clearInterval(autoPlayInterval);
            }
        }, 300);
        
        // Control del bot√≥n play/pause
        musicToggle.addEventListener('click', function() {
            if (audio.paused) {
                audio.muted = false;
                audio.play();
                musicIcon.textContent = '‚è∏';
            } else {
                audio.pause();
                musicIcon.textContent = '‚ñ∂';
            }
        });
        
        // Control de volumen
        volumeSlider.addEventListener('input', function() {
            audio.volume = this.value / 100;
            // Desmutear cuando se ajusta el volumen
            if (audio.muted && this.value > 0) {
                audio.muted = false;
            }
        });
        
        // Actualizar el icono seg√∫n el estado del audio
        audio.addEventListener('play', function() {
            musicIcon.textContent = '‚è∏';
        });
        
        audio.addEventListener('pause', function() {
            musicIcon.textContent = '‚ñ∂';
        });
    </script>
</body>
</html>

